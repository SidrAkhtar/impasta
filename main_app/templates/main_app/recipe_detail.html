{% extends 'base.html' %}
{% block content %}

<h1>{{ recipe.name }}</h1>
<div class="recipe-horiz">
    <div class="recipe-column">
        {% if user == recipe.user %}
        <div>
            <a href="{% url 'recipes_update' recipe.id %}">Edit</a>
            <a href="{% url 'recipes_delete' recipe.id %}">Delete</a>
        </div>
        {% endif %}
        <img src="{{ recipe.img }}" class="show-img">
        <p>Prep Time: {{ recipe.time }}</p>
        <p>Tags: {{ recipe.tags }}</p>



    </div>
    <div class="recipe-column">
        <h2>Reviews</h2>
        {% if user.is_authenticated %}
        {% if user != recipe.user %}
            <form action="{% url 'add_reviews' recipe.id %}" method="POST">
            {% csrf_token %}
            <table>
                {{ review_form.as_table }}
            <table>
            <input type="submit" value="Add Review">
            </form>
        {% endif %}
        {% endif %}
        <table>
            <thead>
            <tr>
                <th>User</th>
                <th>Rating</th>
                <th>Review</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for review in recipe.review_set.all %}
                <tr>
                    <td>{{ review.user }}</td>
                    <td>{{ review.rating }}</td>
                    <td>{{ review.comment }}</td>
                    <td>
                        {% if user == review.user %}
                        <form action="{% url 'reviews_delete' review.id %}" method="POST">
                            {% csrf_token %}
                            <input type="submit" value="X">
                        </form>
                        {% endif %}
                    </td>  
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>  
</div>
<div class="recipe-horiz">
    <div class="recipe-column">
        <h2>Ingredients</h2>
        {% if user == recipe.user %}
        <form action="{% url 'add_ingredients' recipe.id %}" method="POST">
            {% csrf_token %}
            <table>
                {{ ingredient_form.as_table }}
            <table>
            <input type="submit" value="Add Ingredient">
        </form>
        {% endif %}
        <table>
        <thead>
            <tr>
            <th>Quantity</th>
            <th>Ingredient</th>
            <th></th>
            </tr>
        </thead>
        <tbody>
            {% for ingredient in recipe.ingredient_set.all %}
            <tr>
                <td>{{ ingredient.quantity }}</td>
                <td>{{ ingredient.name }}</td>
                <td>
                {% if user == recipe.user %}
                <form action="{% url 'ingredients_delete' ingredient.id %}" method="POST">
                    {% csrf_token %}
                    <input type="submit" value="X">
                </form>
                {% endif %}
                </td>  
            </tr>
            {% endfor %}
        </tbody>
        </table>
    </div>
    <div class="recipe-column">
        <h2>Instructions</h2>
        {% if user == recipe.user %}
        <form action="{% url 'add_instructions' recipe.id %}" method="POST">
            {% csrf_token %}
            <table>
                {{ instruction_form.as_table }}
            <table>
            <input type="submit" value="Add Instruction">
        </form>
        {% endif %}  
        <table>
            <thead>
            <tr>
                <th>Step #</th>
                <th>Instruction</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for instruction in recipe.instruction_set.all %}
                <tr>
                <td>{{ instruction.order }}</td>
                <td>{{ instruction.step }}</td>
                <td>
                    {% if user == recipe.user %}
                    <form action="{% url 'instructions_delete' instruction.id %}" method="POST">
                        {% csrf_token %}
                        <input type="submit" value="X">
                    </form>
                    {% endif %}  
                </td>  
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}